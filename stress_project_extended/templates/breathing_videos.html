{% extends "base.html" %}
{% block content %}
<style>
  /* simple responsive grid */
  .video-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.25rem;
    margin: 1.5rem 0;
  }
  .video-card {
    background: #fff;
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 8px 30px rgba(0,0,0,0.06);
    text-align: center;
  }
  .video-thumb {
    width: 100%;
    height: 160px;
    object-fit: cover;
    border-radius: 8px;
    cursor: pointer;
  }
  .video-title { margin: 0.75rem 0; font-weight: 600; }
  /* modal */
  .video-modal {
    position: fixed; inset: 0; display: none; align-items: center; justify-content: center;
    background: rgba(0,0,0,0.6); z-index: 9999;
  }
  .video-modal.open { display: flex; }
  .video-modal .content {
    width: min(960px, 95%); background: white; border-radius: 10px; overflow: hidden;
  }
  .video-modal iframe { width: 100%; height: 540px; border: 0; display: block; }
  .modal-close { position: absolute; right: 1rem; top: 0.75rem; cursor: pointer; font-size: 1.25rem; z-index: 10001;}
  @media (max-width: 800px) {
    .video-modal iframe { height: 320px; }
    .video-thumb { height: 140px; }
  }
</style>

<section class="container">
  <h1 style="text-align:center; margin-top:1rem;">{{ page_title }}</h1>
  <p style="text-align:center; color:#666;">Pick any guided clip — it will play in a pop-up player.</p>

  <div class="video-grid">
    {% for v in videos %}
      <article class="video-card">
        <!-- youtube thumbnail: https://img.youtube.com/vi/<ID>/hqdefault.jpg -->
        <img class="video-thumb" src="https://img.youtube.com/vi/{{ v.id }}/hqdefault.jpg"
             alt="{{ v.title }}" data-video-id="{{ v.id }}" loading="lazy">
        <div class="video-title">{{ v.title }}</div>
        <button class="play-btn" data-video-id="{{ v.id }}">Play ▶</button>
      </article>
    {% endfor %}
  </div>

  <hr style="margin:2rem 0; opacity:0.08;">

  <p style="text-align:center; color:#444;">
    Want to include your own uploads? Put video IDs into the view or load them from the DB.
  </p>
</section>

<!-- modal -->
<div id="videoModal" class="video-modal" aria-hidden="true">
  <div class="content" role="dialog" aria-modal="true">
    <div style="position:relative;">
      <button id="modalClose" class="modal-close" aria-label="Close">✕</button>
      <iframe id="playerIframe" src="" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
  </div>
</div>

<script>
  (function(){
    const modal = document.getElementById('videoModal');
    const iframe = document.getElementById('playerIframe');
    const close = document.getElementById('modalClose');

    function openVideo(id){
      // autoplay=1 so it starts when modal opens
      iframe.src = `https://www.youtube.com/embed/${id}?autoplay=1&rel=0`;
      modal.classList.add('open');
      modal.setAttribute('aria-hidden', 'false');
    }
    function closeVideo(){
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden', 'true');
      // remove src to stop playback
      iframe.src = "";
    }

    document.querySelectorAll('[data-video-id]').forEach(el=>{
      el.addEventListener('click', ()=> openVideo(el.dataset.videoId));
    });

    close.addEventListener('click', closeVideo);
    modal.addEventListener('click', (e)=>{
      if(e.target === modal) closeVideo();
    });

    // close on Esc
    window.addEventListener('keydown', (e)=> { if(e.key === 'Escape') closeVideo(); });
  })();
</script>

{% endblock %}
